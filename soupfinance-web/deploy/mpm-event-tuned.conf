# Apache mpm_event configuration - Tuned for high-performance static file serving
# Similar to Nginx's event-driven architecture
#
# Memory calculation:
# - Base Apache: ~30MB
# - Per thread: ~2-3MB
# - At MaxRequestWorkers (400): ~900-1200MB total
#
# This configuration supports ~400 concurrent connections with good headroom

<IfModule mpm_event_module>
    # Number of child server processes created at startup
    StartServers             3

    # Minimum number of idle threads available to handle request spikes
    MinSpareThreads         75

    # Maximum number of idle threads (extras are killed)
    MaxSpareThreads        250

    # Maximum number of threads per child process
    ThreadsPerChild         25

    # Maximum number of simultaneous client connections
    # Formula: ServerLimit * ThreadsPerChild = MaxRequestWorkers
    MaxRequestWorkers      400

    # Upper limit on configurable ServerLimit
    # ServerLimit = MaxRequestWorkers / ThreadsPerChild = 400 / 25 = 16
    ServerLimit             16

    # Thread limit per child (usually equals ThreadsPerChild)
    ThreadLimit             64

    # Kill child processes after this many connections (prevents memory leaks)
    # Set to non-zero to recycle workers periodically
    MaxConnectionsPerChild  10000

    # Async connections handling (key for keep-alive efficiency)
    # AsyncRequestWorkerFactor controls the total async connections
    # Total async = (AsyncRequestWorkerFactor * threads) + threads
    # At factor 2: (2 * 400) + 400 = 1200 async connections possible
    AsyncRequestWorkerFactor 2
</IfModule>

# KeepAlive settings - tuned for SPA with many small requests
# (matches Nginx keepalive defaults)
KeepAlive On
MaxKeepAliveRequests 500
KeepAliveTimeout 5
